# 9장 단위 테스트

> 단위 테스트란 TDD의 첫 번째 단계인 기능 단위의 테스트 코드를 작성하는 것을 이야기 한다. TDD와 달리 테스트 코드를 꼭 먼저 작성해야하는 것도 아니고, 리펙토링도 포함하지 않는다. 순수하게 테스트 코드만 작성하는 것을 이야기한다.

## TDD (Test-driven development 테스트 주도 개발) 법칙 세 가지

**첫째: 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.**

**둘째: 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위테스트를 작성한다.**

**셋째: 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.**

위 세가지 규칙을 따르면 개발과 테스트가 대략 30초 주기로 묶이는데, 테스트 코드와 실제 코드가 함께 나올뿐더러 테스트 코드가 실제 코드보다 불과 몇 초 전에 나온다.

이렇게 하면 실제 코드를 사실상 전부 테스트하는 테스트 케이스가 나와서 양이 방대해져서 심각한 관리문제를 유발한다.

그래서 결국 단위 테스트 코드를 깨끗하게 구현해야 실제 코드를 짤 때 더 수월해진다.

테스트 코드를 통해 유연성, 유지보수성, 재사용성을 제공할 수 있도록 해야한다.

## 깨끗한 테스트 코드를 유지하는 방법

테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸린다.

**테스트 코드는 실제 코드 못지 않게 중요하다.**

### 테스트는 유연성, 유지보수성, 재사용을 제공한다.

테스트 케이스가 없으면 실제 코드를 유연하게 만드는 버팀목도 사라진다.

여기서 말하는 버팀목이 바로 **단위 테스트**다.

그리고 깨끗한 테스트 코드를 만들며 가장 중요한 것은 "**가독성**"이다.

**"가독성"**을 높이려면 명료성, 단순성, 풍부한 표현력이 필요하다. 최소의 표현으로 많은 것을 나타내야한다.

### 도메인에 특화된 테스트 언어

흔히 쓰는 시스템 조작 API를 사용하는 대신 API 위에다 함수와 유틸리티를 구현한 후 그 함수와 유틸리티를 사용하면 테스트 코드를 짜기도 읽기도 쉬워진다. 즉, 테스트를 구현하는 당사자와 나중에 테스트를 읽어볼 사람들을 도와주는 테스트 언어이다.

### 이중 표준

테스트 API코드에 적용하는 표준은 실제 코드에 적용하는 표준과는 확실히 다르다.

단순하고, 간결하고, 표현력이 풍부해야 하지만, 실제 코드만큼 효율적인 필요는 없다.

테스트 환경에서 돌아가기 때문이다.

이중 표준의 본질은 실제 환경에서는 절대 안 되지만 테스트 환경에서는 전혀 문제없는 방식이다.

### 테스트 당 assert 하나

JUnit으로 (js에서는 mocha 등..) 테스트 코드를 짤 때는 함수마다 assert문을 하나만 사용해야 한다고 주장하는 학파가 있다. assert문의 단 하나인 함수는 결론이 하나라서 코드가 이해하기 쉽고 빠르다.

이것보다 조금 더 살을 붙이자면 **"테스트 함수마다 한 개념만 테스트하라"** 라는 규칙으로 부를 수 있다.

이것저것 잡다한 개념을 연속으로 테스트하는 긴 함수는 피하자.

## F.I.R.S.T - 깨끗한 테스트의 다섯 가지 규칙

### 빠르게 Fast

테스트가 느리다 = 하기 싫어진다 = 초반에 문제를 못 찾는다 = 코드 품질이 망가진다.

### 독립적으로 Independent

각 테스트는 서로 의존하면 안된다.

### 반복 가능하게 Repeatable

실제 환경, QA 환경, 퇴근길에 사용하는 노트북에서도 실행할 수 있어야 한다. (변명 금지)

### 자가검증하는 Self-Validating

테스트는 Bool 값으로 결과를 내야한다. 성공 아니면 실패로.

### 적시에 Timely

단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다.

## Mocha(js test framework) 간단 소개

### assert

assertion 함수를 쉽게 사용하기 위해 node.js에서 제공하는 표준 모듈

### describe

테스트 케이스를 생성한다.

```jsx
describe("테스트이름", () => {});
```

### it

it으로 테스트 코드 작성. 첫번째 인수는 테스트 케이스 이름, 두번째 인수는 done객체를 전달해줄 테스트 케이스의 함수

```jsx
test / test.js;

var assert = require("assert"); //nodejs에서 제공하는 aseert 모듈

describe("계산기 테스트", () => {
  it("1+1은 2를 반환", (done) => {
    assert.equal(1 + 1, 2);
    done();
  });

  it("2*2 는 4를 반환", (done) => {
    assert.equal(2 * 2, 4);
    done();
  });
});
```

test.js 파일을 저장하고 terminal에 mocha를 호출하면 테스트 가능.

### 터미널: mocha

```jsx
// 결과
계산기 테스트
  ✓ 1+1은 2를 반환
  ✓ 2*2 는 4를 반환
```
